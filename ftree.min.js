function familyTree(e,t){function S(){var e=[];for(var t=0;t!=this.generations.length;t++){for(var n=0;n!=this.generations[t].length;n++){e.push(this.generations[t][n])}}for(var t=0;t!=this.singletons.length;t++){e.push(this.singletons[t])}return e}function x(e){var t=[];var n=[];var r=[];if(!e){return false}if(!e.isArray){e=[e]}if(e.length===0){return{generations:[],singletons:[]}}if(e.length===1){return{generations:[e],singletons:[]}}for(var i=0;i!=e.length;i++){if(e[i].father){break}}if(i===e.length){var s=e[0]}else{var s=e[i]}var o=s;while(o.father&&e.indexOf(o.father)!==-1){o=o.father}r.push(o);if(o.partner&&e.indexOf(o.partner)!==-1){r.push(o.partner)}t.push(r);r=[];children=N(o,e);var u,a=[];var f;while(children.length>0){u=[];for(var i=0;i!=children.length;i++){r.push(children[i]);partner=children[i].partner;if(partner&&e.indexOf(partner)!==-1){if(children.indexOf(partner)===-1){r.push(partner);a=N(children[i],e);for(var l=0;l!=a.length;l++){if(u.indexOf(a[l])===-1)u.push(a[l])}}}}t.push(r);r=[];children=u}var c=0;var h=0;var p=[];var d=0;var v=false;while(h<e.length){found_this_time=false;o=e[c];if(C(o,t)===-1){siblings=T(o,e);for(var i=0;i!=siblings.length;i++){sibling=siblings[i];if(C(sibling,t)!==-1){generation_index=k(sibling,t);t[generation_index].push(o);found_this_time=true;break}}if(!found_this_time){partner=o.partner;if(partner){if(C(partner,t)!==-1){generation_index=k(partner,t);t[generation_index].push(o);found_this_time=true}}}if(!found_this_time){father=o.father;if(father){if(C(father,t)!==-1){generation_index=k(father,t);if(generation_index===t.length-1){t.push([o])}else{t[generation_index+1].push(o)}found_this_time=true}}}if(!found_this_time){children=N(o,e);for(var i=0;i!=children.length;i++){f=children[i];if(C(f,t)!==-1){generation_index=k(f,t);if(generation_index>0){t[generation_index-1].push(o)}else{t.splice(0,0,[o])}found_this_time=true;break}}}if(found_this_time){h++;v=true}}c++;if(c>e.length-1){c=0;d++;if(d>1){if(!v){for(var i=0;i!=e.length;i++){if(C(e[i],t)===-1){p.push(e[i])}}break}}v=false}}return{generations:t,singletons:p}}function T(e,t){var n=[];if(e.father||e.mother){for(var r=0;r!=t.length;r++){if(t[r].father===e.father||t[r].mother===e.mother){n.push(t[r])}}}return n}function N(e,t){var n=[];for(var r=0;r!=t.length;r++){if(t[r].father===e||t[r].mother===e){n.push(t[r])}}return n}function C(e,t){var n;if(t[0].isArray){for(var r=0;r!=t.length;r++){n=t[r].indexOf(e);if(n!=-1){return n}}}else{n=t.indexOf(e);if(n!=-1){return n}}return-1}function k(e,t){var n;for(var r=0;r!=t.length;r++){n=t[r].indexOf(e);if(n!=-1){return r}}return-1}function L(){for(var e=0;e!=this.generations.length;e++){var t=C(this.generations[e][0].partner,this.generations);if(t===1&&this.generations[e].length>3){var n=this.generations[e][0];this.generations[e][0]=this.generations[e][1];this.generations[e][1]=n}else{if(t===this.generations[e].length-2&&this.generations[e].length>3){var n=this.generations[e][this.generations[e].length-2];this.generations[e][this.generations[e].length-2]=this.generations[e][this.generations[e].length-1];this.generations[e][this.generations[e].length-1]=n}}}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e,t){if(t==null){t=0}else if(t<0){t=Math.max(0,this.length+t)}for(var n=t,r=this.length;n<r;n++){if(this[n]===e)return n}return-1}}Array.prototype.isArray=true;var n="#111",r="#eee",i="aae",s="#eaa",o="#999",u=2,a="#ddd",f=100,l=100,c=150,h=150,p=100,d=100,v="14";this.generations=[];this.singletons=[];for(var m=0;m!=e.length;m++){if(e[m].partner||e.indexOf(e[m].partner)!==-1){if(e[m].partner.partner!==e[m]){e[m].partner.partner=e[m]}}}var g=x(e);if(!g)return false;this.generations=g.generations;this.singletons=g.singletons;if(this.generations.length===0){return false}this.color=t.color||n;this.fillColor=t.fillColor||r;this.femaleFillColor=t.femaleFillColor||i;this.maleFillColor=t.maleFillColor||s;this.strokeColor=t.strokeColor||o;this.strokeWidth=t.strokeWidth||u;this.mouseoverColor=t.mouseoverColor||a;this.width=t.width||c;this.height=t.height||h;this.startX=t.startX||f;this.startY=t.startY||l;this.fontSize=t.fontSize||v;this.vDistance=t.vDistance||p;this.hDistance=t.hDistance||d;this.onClick=t.onClick||function(){};this.getText=t.getText;this.canvas=null;var y=this.femaleFillColor;var b=this.maleFillColor;var w=this.fillColor;var E=this.mouseoverColor;this.onmouseover=function(){this.data.node.attr({fill:E})};this.onmouseout=function(){switch(this.data.person.gender){case"M":this.data.node.attr({fill:b});break;case"F":this.data.node.attr({fill:y});break;default:this.data.node.attr({fill:w})}};this.hide=function(){if(this.canvas){this.canvas.remove();for(var e=0;e!=this.generations.length;e++){for(var t=0;t!=this.generations[e].length;t++){if(this.generations[e][t].node){this.generations[e][t].node.node.remove();this.generations[e][t].node.text.remove()}}}for(var e=0;e!=this.singletons.length;e++){if(this.singletons[e].node){this.singletons[e].node.node.remove();this.singletons[e].node.text.remove()}}}};this.remove=function(e){if(!e){console.log("trying to remove undefined or null");return 0}var t=S.call(this);if(e.isArray){if(e.length===0){console.log("trying to remove an empty array");return 0}}else{e=[e]}var n,r=0;for(var i=0;i!=e.length;i++){n=t.indexOf(e[i]);if(n!==-1){t.splice(n,1);r++}else{console.log("trying to remove a non-existing person")}}var s=x(t);this.generations=s.generations;this.singletons=s.singletons;return r};this.append=function(e){if(!e){console.log("trying to append undefined or null");return 0}var t=S.call(this);if(e.isArray){if(e.length===0){console.log("trying to append an empty array");return 0}}else{e=[e]}for(var n=0;n!=e.length;n++){t.push(e[n])}var r=x(t);this.generations=r.generations;this.singletons=r.singletons;return e.length};this.show=function(){function d(e,t,n,r,i,s){var o=this.canvas.rect(e,t,n,r,10);var u=this.canvas.text(e+n/2,t+r/2-10,this.getText(i));u.attr("font-size",this.fontSize);var a;switch(i.gender){case"M":a=this.maleFillColor;break;case"F":a=this.femaleFillColor;break;default:a=this.fillColor}o.attr({stroke:this.color,fill:a,translation:"4,4",text:u});o.blur(1);var f=this.onClick;o.click(function(){f(i)});o.data={node:o,person:i};u.click(function(){f(i)});u.data={node:o,person:i};return{node:o,text:u}}var e=[],t=1,n=this.generations,r=this.singletons,i,s,o,u,a,f;L.call(this);for(var l=0;l!=n.length;l++){if(t<n[l].length){t=n[l].length}}if(t<r.length){t=r.length}for(var l=0;l!=n.length;l++){e[l]=(this.width+this.hDistance)/2*(t-n[l].length)}if(this.canvas){this.hide()}this.canvas=Raphael(this.startX,this.startY,t*(this.width+this.hDistance),(n.length+1)*(this.height+this.vDistance));var c=[];for(var l=0;l!=n.length;l++){for(var h=0;h!=n[l].length;h++){s=e[l]+h*(this.width+this.hDistance);o=l*(this.height+this.vDistance);this.generations[l][h].node=d.call(this,s,o,this.width,this.height,this.generations[l][h],"");n[l][h].node.node.mouseover(this.onmouseover);n[l][h].node.node.mouseout(this.onmouseout);n[l][h].node.text.mouseover(this.onmouseover);n[l][h].node.text.mouseout(this.onmouseout);if(n[l][h].partner){if(C(n[l][h].partner,n)>h){i="M "+(s+this.width)+" "+(o+this.height/2)+" h "+this.hDistance}this.canvas.path(i).attr({"stroke-width":this.strokeWidth}).attr({stroke:this.strokeColor})}if(n[l][h].father){i="M "+(s+this.width/2)+" "+o+" v -"+this.vDistance/2;u=C(n[l][h].father,n);a=C(n[l][h].mother,n);if(u!=-1){if(u<a){f=u}else{f=a}}i=i+" L "+(e[l-1]+(this.width+this.hDistance)*f+this.width+this.hDistance/2);i=i+" "+((l-1)*(this.vDistance+this.height)+this.height);i=i+" v -"+this.height/2}this.canvas.path(i).attr({"stroke-width":this.strokeWidth}).attr({stroke:this.strokeColor})}}var p=this.generations.length*(this.height+this.vDistance);for(var l=0;l!=this.singletons.length;l++){this.singletons[l].node=d.call(this,(this.width+this.hDistance)*l,p,this.width,this.height,this.singletons[l],"");r[l].node.node.mouseover(this.onmouseover);r[l].node.node.mouseout(this.onmouseout);r[l].node.text.mouseover(this.onmouseover);r[l].node.text.mouseout(this.onmouseout);if(r[l].partner){if(C(r[l].partner,r)>l){i="M "+((this.width+this.hDistance)*l+this.width)+" "+(p+this.height/2)+" h "+this.hDistance}path=this.canvas.path(i);path.attr({"stroke-width":this.strokeWidth}).attr({stroke:this.strokeColor})}}}}